{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"title": "Server Handshake",
	"description": "Message sent from the server to a client during the handshake",
	"allOf": [{ "$ref": "/schemas/message.json" }],
	"anyOf": [
		{
			"properties": {
				"type": { "const": "hello" },
				"data": {
					"additionalProperties": false,
					"required": ["version", "plugins"],
					"properties": {
						"version": { "type": "string" },
						"plugins": {
							"type": "object",
							"additionalProperties": { "type": "string" }
						}
					}
				}
			}
		},
		{
			"properties": {
				"type": { "const": "ready" },
				"data": {
					"additionalProperties": false,
					"required": ["session_token", "session_timeout", "heartbeat_interval"],
					"properties": {
						"session_token": { "type": "string" },
						"session_timeout": { "type": "number" },
						"heartbeat_interval": { "type": "number" },
						"account": {
							"type": "object",
							"additionalProperties": false,
							"required": ["name", "roles"],
							"properties": {
								"name": { "type": "string" },
								"roles": {
									"type": "array",
									"items": {
										"additionalProperties": false,
										"type": "object",
										"required": ["name", "id", "permissions"],
										"properties": {
											"name": { "type": "string" },
											"id": { "type": "integer" },
											"permissions": {
												"type": "array",
												"items": { "type": "string" }
											}
										}
									}
								}
							}
						}
					}
				}
			}
		},
		{
			"properties": {
				"type": { "const": "continue" },
				"data": {
					"additionalProperties": false,
					"required": ["last_seq", "session_timeout", "heartbeat_interval"],
					"properties": {
						"last_seq": { "type": ["integer", "null"] },
						"session_timeout": { "type": "number" },
						"heartbeat_interval": { "type": "number" },
					}
				}
			}
		},
		{
			"properties": {
				"type": { "const": "invalidate" },
				"data": { "const": {} }
			}
		}
	]
}